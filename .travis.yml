services:
  - docker
env:
  global:
    # should change to yours
    - secure: "dyDvDua+1R+f0/aHJIYAmmcTD6DFr8FzYhn2Dp0IlfWv0kA0zQtCjVMAxMFJTmhdH4u9hGf26pCe7CbdJRXHd5/rdZws/oovRtS8OdAf3SYdkk73VsJgPfPMPYJYScCcTt3xiTQOLpC8S/LjFlSOrC5fwQRYJy5i6ydQ89bnsU82E6/PTRRxHZmVQqa21325BPLdImcowhjiWw1SlSGsYZcpy0q3Wx5ZTFw5NQcyMBV4SXxDb+hxW3e1CpkmzbVB14KSUppMOiJnpunmgghy91S8rjclKnlKXUVS7AAXT0ZEmCaQNg1AC+HFngPyazs8brH5YlN1k7RQ8UgjdYoUXAhps/GBio2VMusbLXuoxxrNi6iJ9R4bd6s0SRdd0IgIX0uEUNUuYjw79bsNZUI9PFqmOmDa5jnaWUm6L94MzsqX28DJgPnAXyL5laOM87A3m4UxmZLUqN9L+pMJaVpDZCpg1NOACQhDaBjgOctUcE8JcwRgiN04RbdB+yA8+Us5YRkAyJWGMt6NL9SNf0TUPTME+zmSke6KISsvnIQFlWE8LycrR8aiQNi22oxd/IAHujbG1rAH2gC1ko7hb1nLMzcx5TU/6Oosbv4phWDKwAzd3eKgamWYlj5srOWjaoQg3JMKbY4oDAGO1kVYRTP5CYxZZoQZmfkQw0k3MqbFc6o="
    
before_install:
  - echo "Login into heroku"
  - heroku container:login
jobs:
  include:
    - stage: push
      script:
        - docker build -t ch4-web:latest -f ./Dockerfile .
        # should change to yours
        - docker tag ch4-web:latest registry.heroku.com/ch4demo/web
        # should change to yours
        - docker push registry.heroku.com/ch4demo/web
      deploy:
        - provider: script
          # should change to yours
          script: heroku container:release web --app ch4demo
          on: # 不設這個 預設只有在 master branch 會做 deploy
            branch: main
